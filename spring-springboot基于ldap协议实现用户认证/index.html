<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>springboot基于ldap协议实现用户认证 | 张晓风的博客</title><meta name="author" content="张晓风"><meta name="copyright" content="张晓风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、引入spring-boot-starter-data-ldap依赖1234&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-data-ldap&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependenc">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot基于ldap协议实现用户认证">
<meta property="og:url" content="https://zhangyuliang1994.github.io/spring-springboot%E5%9F%BA%E4%BA%8Eldap%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/index.html">
<meta property="og:site_name" content="张晓风的博客">
<meta property="og:description" content="一、引入spring-boot-starter-data-ldap依赖1234&lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-data-ldap&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependenc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2024/01/23/uiAYVvz6TSpaqPB.jpg">
<meta property="article:published_time" content="2024-03-07T17:24:19.000Z">
<meta property="article:modified_time" content="2024-03-07T17:24:19.000Z">
<meta property="article:author" content="张晓风">
<meta property="article:tag" content="springboot">
<meta property="article:tag" content="ldap">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/01/23/uiAYVvz6TSpaqPB.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "springboot基于ldap协议实现用户认证",
  "url": "https://zhangyuliang1994.github.io/spring-springboot%E5%9F%BA%E4%BA%8Eldap%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/",
  "image": "https://s2.loli.net/2024/01/23/uiAYVvz6TSpaqPB.jpg",
  "datePublished": "2024-03-07T17:24:19.000Z",
  "dateModified": "2024-03-07T17:24:19.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "张晓风",
      "url": "https://zhangyuliang1994.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="https://s2.loli.net/2024/01/25/oc9IQwyfZJgTBAE.png"><link rel="canonical" href="https://zhangyuliang1994.github.io/spring-springboot%E5%9F%BA%E4%BA%8Eldap%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.3.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'springboot基于ldap协议实现用户认证',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://s2.loli.net/2024/01/23/uiAYVvz6TSpaqPB.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">张晓风的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">springboot基于ldap协议实现用户认证</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">springboot基于ldap协议实现用户认证</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-07T17:24:19.000Z" title="发表于 2024-03-07 17:24:19">2024-03-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-07T17:24:19.000Z" title="更新于 2024-03-07 17:24:19">2024-03-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/spring/">spring</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h3 id="一、引入spring-boot-starter-data-ldap依赖"><a href="#一、引入spring-boot-starter-data-ldap依赖" class="headerlink" title="一、引入spring-boot-starter-data-ldap依赖"></a>一、引入<code>spring-boot-starter-data-ldap</code>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-ldap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="二、配置文件"><a href="#二、配置文件" class="headerlink" title="二、配置文件"></a>二、配置文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ldap:</span></span><br><span class="line">    <span class="attr">urls:</span> <span class="string">ldap://xx.xx.xx.xx:389</span></span><br><span class="line">    <span class="attr">base:</span> <span class="string">OU=xxx,DC=xxx,DC=com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">xxx@xx.com</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxx</span></span><br></pre></td></tr></table></figure>
<p>在配置文件里填入地址、baseDN、用户名和密码信息</p>
<h3 id="三、创建用户对象类"><a href="#三、创建用户对象类" class="headerlink" title="三、创建用户对象类"></a>三、创建用户对象类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.odm.annotations.Attribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.odm.annotations.Entry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.odm.annotations.Id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ldap协议person类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entry(objectClasses = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 唯一标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@JSONField(serialize = false)</span></span><br><span class="line">    <span class="keyword">private</span> Name distinguishedName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute(name = &quot;sAMAccountName&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户姓名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute(name = &quot;cn&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 权限码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute(name = &quot;userAccountControl&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer userAccountControl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDelete;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="四、用户登录"><a href="#四、用户登录" class="headerlink" title="四、用户登录"></a>四、用户登录</h3><h4 id="4-1-示例代码"><a href="#4-1-示例代码" class="headerlink" title="4.1 示例代码"></a>4.1 示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.ldap.core.LdapTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.filter.EqualsFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> LdapTemplate ldapTemplate;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LDAP_USERNAME_ATTR</span> <span class="operator">=</span> <span class="string">&quot;sAMAccountName&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String userName, String password)</span> &#123;</span><br><span class="line">    <span class="type">EqualsFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualsFilter</span>(LDAP_USERNAME_ATTR, userName);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> ldapTemplate.authenticate(<span class="string">&quot;&quot;</span>, filter.toString(), password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基本逻辑就是调用ldapTemplate的authenticate方法来进行认证。</p>
<h4 id="4-2-完整代码"><a href="#4-2-完整代码" class="headerlink" title="4.2 完整代码"></a>4.2 完整代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cowave.meter.admin.user.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.IdUtil;</span><br><span class="line"><span class="keyword">import</span> com.cowave.commons.framework.access.Access;</span><br><span class="line"><span class="keyword">import</span> com.cowave.commons.framework.filter.security.AccessToken;</span><br><span class="line"><span class="keyword">import</span> com.cowave.commons.framework.filter.security.TokenService;</span><br><span class="line"><span class="keyword">import</span> com.cowave.commons.framework.support.mybatis.page.PageDO;</span><br><span class="line"><span class="keyword">import</span> com.cowave.commons.framework.util.Asserts;</span><br><span class="line"><span class="keyword">import</span> com.cowave.commons.framework.util.AssertsException;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.dao.SysDeptDao;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.dao.SysRoleDao;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.dao.SysUserDao;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.pojo.Person;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.pojo.SysDept;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.pojo.SysRole;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.pojo.SysUser;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.service.LdapService;</span><br><span class="line"><span class="keyword">import</span> com.cowave.meter.admin.user.service.SysUserService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.core.LdapTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.filter.EqualsFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ldap.query.LdapQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ObjectUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LdapServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LdapService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LdapTemplate ldapTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TokenService tokenService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SysUserDao sysUserDao;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SysUserService userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SysDeptDao sysDeptDao;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SysRoleDao sysRoleDao;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">BCryptPasswordEncoder</span> <span class="variable">bcryptPasswordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LDAP_USERNAME_ATTR</span> <span class="operator">=</span> <span class="string">&quot;sAMAccountName&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 域账号登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AccessToken <span class="title function_">domainLogin</span><span class="params">(String userName, String password)</span> &#123;</span><br><span class="line">        <span class="type">EqualsFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualsFilter</span>(LDAP_USERNAME_ATTR, userName);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">authenticate</span> <span class="operator">=</span> ldapTemplate.authenticate(<span class="string">&quot;&quot;</span>, filter.toString(), password);</span><br><span class="line">        <span class="keyword">if</span> (!authenticate) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertsException</span>(<span class="string">&quot;auth.failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">domainUserAccountExist</span> <span class="operator">=</span> sysUserDao.domainUserAccountExist(userName);</span><br><span class="line">        <span class="keyword">if</span> (Boolean.FALSE.equals(domainUserAccountExist)) &#123;</span><br><span class="line">            <span class="type">LdapQueryBuilder</span> <span class="variable">ldapQuery</span> <span class="operator">=</span> LdapQueryBuilder.query();</span><br><span class="line">            ldapQuery.filter(filter);</span><br><span class="line">            <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> ldapTemplate.findOne(ldapQuery, Person.class);</span><br><span class="line">            <span class="keyword">if</span> (ObjectUtils.isEmpty(person)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertsException</span>(<span class="string">&quot;user.notexist&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SysUser</span>();</span><br><span class="line">            sysUser.setUserAccount(userName);</span><br><span class="line">            Asserts.isFalse(userService.userAccountExist(sysUser), <span class="string">&quot;账户名已存在&quot;</span>);</span><br><span class="line">            sysUser.setUserName(person.getName());</span><br><span class="line">            sysUser.setUserPasswd(bcryptPasswordEncoder.encode(password));</span><br><span class="line">            sysUser.setDomainUserAccount(userName);</span><br><span class="line">            <span class="comment">// 设置部门</span></span><br><span class="line">            <span class="type">SysDept</span> <span class="variable">sysDept</span> <span class="operator">=</span> sysDeptDao.queryRootDept();</span><br><span class="line">            <span class="keyword">if</span> (!ObjectUtils.isEmpty(sysDept)) &#123;</span><br><span class="line">                sysUser.setDeptId(sysDept.getDeptId());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 设置角色</span></span><br><span class="line">            PageDO&lt;SysRole&gt; sysRolePageDO = sysRoleDao.queryPage(<span class="literal">null</span>, <span class="string">&quot;2&quot;</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (sysRolePageDO.getPages() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">SysRole</span> <span class="variable">sysRole</span> <span class="operator">=</span> sysRolePageDO.getList().get(<span class="number">0</span>);</span><br><span class="line">                sysUser.setRoleId(sysRole.getRoleId());</span><br><span class="line">            &#125;</span><br><span class="line">            userService.saveOrUpdate(sysUser);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> sysUserDao.getByDomainUserAccount(userName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> sysUser.getUserId();</span><br><span class="line">        <span class="type">AccessToken</span> <span class="variable">accessToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccessToken</span>();</span><br><span class="line">        accessToken.setType(AccessToken.TYPE_USER);</span><br><span class="line"></span><br><span class="line">        accessToken.setUserCode(userId);</span><br><span class="line">        accessToken.setUsername(sysUser.getUserAccount());</span><br><span class="line">        accessToken.setUserNick(sysUser.getUserName());</span><br><span class="line">        accessToken.setDeptCode(sysUser.getDeptId());</span><br><span class="line">        accessToken.setRoles(List.of(sysUser.getRoleId()));</span><br><span class="line"></span><br><span class="line">        accessToken.setLoginIp(Access.ip());</span><br><span class="line">        accessToken.setLoginTime(Access.time());</span><br><span class="line">        accessToken.setAccessIp(Access.ip());</span><br><span class="line">        accessToken.setAccessTime(Access.time());</span><br><span class="line">        accessToken.setId(IdUtil.fastSimpleUUID());</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> tokenService.newToken(accessToken);</span><br><span class="line">        accessToken.setToken(token);</span><br><span class="line">        <span class="keyword">return</span> accessToken;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-判断用户是否禁用"><a href="#4-3-判断用户是否禁用" class="headerlink" title="4.3 判断用户是否禁用"></a>4.3 判断用户是否禁用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据AD域的userAccountControl属性判断用户是否禁用</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> userAccContr</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> Boolean <span class="title function_">getUserDelete</span><span class="params">(<span class="type">int</span> userAccContr)</span> &#123;</span><br><span class="line">    <span class="comment">//TRUSTED_TO_AUTH_FOR_DELEGATION - 允许该帐户进行委派</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">16777216</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">16777216</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//PASSWORD_EXPIRED - (Windows 2000/Windows Server 2003) 用户的密码已过期</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">8388608</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">8388608</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//DONT_REQ_PREAUTH</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">4194304</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">4194304</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//USE_DES_KEY_ONLY - (Windows 2000/Windows Server 2003) 将此用户限制为仅使用数据加密标准 (DES) 加密类型的密钥</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">2097152</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">2097152</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//NOT_DELEGATED - 设置此标志后，即使将服务帐户设置为信任其进行 Kerberos 委派，也不会将用户的安全上下文委派给该服务</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">1048576</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">1048576</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TRUSTED_FOR_DELEGATION - 设置此标志后，将信任运行服务的服务帐户（用户或计算机帐户）进行 Kerberos 委派。</span></span><br><span class="line">    <span class="comment">// 任何此类服务都可模拟请求该服务的客户端。若要允许服务进行 Kerberos 委派，必须在服务帐户的 userAccountControl 属性上设置此标志</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">524288</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">524288</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//SMARTCARD_REQUIRED - 设置此标志后，将强制用户使用智能卡登录</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">262144</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">262144</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//MNS_LOGON_ACCOUNT - 这是 MNS 登录帐户</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">131072</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">131072</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//DONT_EXPIRE_PASSWORD-密码永不过期</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">65536</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">65536</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//MNS_LOGON_ACCOUNT - 这是 MNS 登录帐户</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">2097152</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">2097152</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//SERVER_TRUST_ACCOUNT - 这是属于该域的域控制器的计算机帐户</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">8192</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">8192</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//WORKSTATION_TRUST_ACCOUNT - 这是运行 Microsoft Windows NT 4.0 Workstation、Microsoft Windows NT 4.0 Server、</span></span><br><span class="line">    <span class="comment">// Microsoft Windows 2000 Professional 或 Windows 2000 Server 并且属于该域的计算机的计算机帐户</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">4096</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">4096</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//INTERDOMAIN_TRUST_ACCOUNT - 对于信任其他域的系统域，此属性允许信任该系统域的帐户</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">2048</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">2048</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//NORMAL_ACCOUNT - 这是表示典型用户的默认帐户类型</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">512</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">512</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TEMP_DUPLICATE_ACCOUNT - 此帐户属于其主帐户位于另一个域中的用户。此帐户为用户提供访问该域的权限，</span></span><br><span class="line">    <span class="comment">// 但不提供访问信任该域的任何域的权限。有时将这种帐户称为“本地用户帐户”</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">256</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">256</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ENCRYPTED_TEXT_PASSWORD_ALLOWED - 用户可以发送加密的密码</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">128</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//PASSWD_CANT_CHANGE - 用户不能更改密码。可以读取此标志，但不能直接设置它</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">64</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">64</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//PASSWD_NOTREQD - 不需要密码</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">32</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//LOCKOUT</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">16</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">16</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//HOMEDIR_REQUIRED - 需要主文件夹</span></span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">8</span>) &#123;</span><br><span class="line">        userAccContr = userAccContr - <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (userAccContr &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://zhangyuliang1994.github.io">张晓风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://zhangyuliang1994.github.io/spring-springboot%E5%9F%BA%E4%BA%8Eldap%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/">https://zhangyuliang1994.github.io/spring-springboot%E5%9F%BA%E4%BA%8Eldap%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://zhangyuliang1994.github.io" target="_blank">张晓风的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a><a class="post-meta__tags" href="/tags/ldap/">ldap</a></div><div class="post-share"><div class="social-share" data-image="https://s2.loli.net/2024/01/23/uiAYVvz6TSpaqPB.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3-Jira%E9%85%8D%E7%BD%AELdap%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E8%A1%8C%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/" title="Jira配置Ldap服务器进行用户认证"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Jira配置Ldap服务器进行用户认证</div></div><div class="info-2"><div class="info-item-1"> Jira需要通过公司的域账号来登录，配置过程中踩了点坑，记录一下。  一、配置步骤1.1 添加LDAP认证用管理员账户登录Jira页面，在配置页面，找到“用户管理” -&gt; 点击“用户目录” -&gt; 点击“添加目录” -&gt; 选择“内部LDAP认证” 1.2 配置服务器目录类型选择“OpenLDAP”，填写主机名、端口、用户名及密码，提前创建组，并在“默认组成员”输入框内填写该组名，防止域账户没有权限登录Jira系统 1.3 设置基本DN和用户名属性这里要看ldap服务器的具体值，我这个版本用户名属性的默认值是cn，但ldap服务器的是sAMAccountName 1.4 设置用户模式属性虽然这些属性有默认值，但还是要看ldap服务器的具体值，我的ldap服务器的用户对象类是person，用户唯一的ID属性是distinguishedName 1.5 设置组模式这里我改了组对象类。 二、推荐工具我用的是Ldap Browser，还不错。下载地址：...</div></div></div></a><a class="pagination-related" href="/spring-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3/" title="自定义校验注解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">自定义校验注解</div></div><div class="info-2"><div class="info-item-1">一、背景近期在用 javax.validation 做校验的时候发现没有对 BigDecimal 类型进行校验的注解，便自己动手写了一个。 二、定义注解及校验类2.1 注解类123456789101112131415@Documented@Constraint(validatedBy = BigDecimalRangeValidator.class)@Target(ElementType.FIELD)@Retention(RetentionPolicy.RUNTIME)public @interface BigDecimalRange &#123;    double min() default Double.MIN_VALUE;    double max() default Double.MAX_VALUE;    String message() default &quot;Validation failed&quot;;    Class&lt;?&gt;[] groups() default &#123;&#125;;    Class&lt;? extends...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/spring-SpringBoot-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" title="SpringBoot 自动装配原理详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-02</div><div class="info-item-2">SpringBoot 自动装配原理详解</div></div><div class="info-2"><div class="info-item-1">每次问到 Spring Boot， 面试官非常喜欢问这个问题：“讲述一下 SpringBoot 自动装配原理？”。 我觉得我们可以从以下几个方面回答：  什么是 SpringBoot 自动装配？ SpringBoot 是如何实现自动装配的？如何实现按需加载？ 如何实现一个 Starter？  一、什么是 SpringBoot 自动装配？我们现在提到自动装配的时候，一般会和 Spring Boot 联系在一起。但是，实际上 Spring Framework 早就实现了这个功能。Spring Boot 只是在其基础上，通过 SPI 的方式，做了进一步优化。  SpringBoot 定义了一套接口规范，这套规范规定：SpringBoot 在启动时会扫描外部引用 jar 包中的META-INF/spring.factories文件，将文件中配置的类型信息加载到 Spring 容器（此处涉及到 JVM 类加载机制与 Spring 的容器知识），并执行类中定义的各种操作。对于外部 jar 来说，只需要按照 SpringBoot 定义的标准，就能将自己的功能装置进 SpringBoot。自...</div></div></div></a><a class="pagination-related" href="/spring-smart-doc%E4%BD%BF%E7%94%A8%E6%B3%A8%E9%87%8A%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="smart-doc使用注释生成接口文档"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-30</div><div class="info-item-2">smart-doc使用注释生成接口文档</div></div><div class="info-2"><div class="info-item-1">一、写在前面程序员最讨厌的事情就是写文档，尤其是接口文档。之前也用过swagger，但是感觉每个类、方法、字段都要加注解，实在是太麻烦了，最近发现smart-doc很好的解决了这个问题，因为它是无侵入式的，只要正常写Java注释，它就能帮你生成各种格式的接口文档。官方文档地址：https://smart-doc-group.github.io/#/zh-cn/ 二、maven插件配置12345678910111213141516&lt;plugin&gt;    &lt;groupId&gt;com.github.shalousun&lt;/groupId&gt;    &lt;artifactId&gt;smart-doc-maven-plugin&lt;/artifactId&gt;    &lt;version&gt;2.6.0&lt;/version&gt;    &lt;executions&gt;        &lt;execution&gt;            &lt;phase&gt;compile&lt;/phase&gt;           ...</div></div></div></a><a class="pagination-related" href="/spring-spring-boot-logback%E6%97%A5%E5%BF%97%E6%98%BE%E7%A4%BA%E6%97%B6%E9%97%B4%E5%B7%AE8%E5%B0%8F%E6%97%B6/" title="spring boot logback日志显示时间差8小时"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-23</div><div class="info-item-2">spring boot logback日志显示时间差8小时</div></div><div class="info-2"><div class="info-item-1">一、问题logback日志的时间和系统时间对不上，总是差几个小时，设置了项目时区没有用，项目里 new Date() 的时间没问题。 二、原因同一个项目部署在两台机器上，之前那台时间是正常的，这台时间不正常，暂时没找到具体原因。 三、解决方法改一下logback的配置文件 pattern 的时间格式  修改前1&lt;property name=&quot;pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss:SSS&#125; %thread [%level] %m%n&quot;/&gt; 修改后1&lt;property name=&quot;pattern&quot; value=&quot;%d&#123;yyyy-MM-dd HH:mm:ss:SSS,CTT&#125; %thread [%level] %m%n&quot;/&gt; 在yyyy-MM-dd HH:mm:ss.SSS后面加一个指定的时区,用逗号分隔开。如yyyy-MM-dd HH:mm:ss.SSS,CTT。CTT为上海时间。改完后确实可以了。  </div></div></div></a><a class="pagination-related" href="/spring-springboot%E4%BD%BF%E7%94%A8jasypt%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/" title="springboot使用jasypt加密解密"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-26</div><div class="info-item-2">springboot使用jasypt加密解密</div></div><div class="info-2"><div class="info-item-1"> 项目上有些配置需要加密，比如数据库的密码，jasypt可以实现加密解密功能。  一、引入依赖12345&lt;dependency&gt;    &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;    &lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt;    &lt;version&gt;3.0.5&lt;/version&gt;&lt;/dependency&gt; 二、配置文件加密前123spring:  datasource:    password: 123456  加密后123spring:  datasource:    password: ENC(slZULLmbudl1M6/43iq6y8100XQ4DlqnxtToLxtUODxqlsCm02M2ujbx6ayy4j92)  三、加密这里以ASE256为例 12345678// 指定算法AES256TextEncryptor textEncryptor = new...</div></div></div></a><a class="pagination-related" href="/spring-springboot%E5%8A%A0%E5%85%A5websocket/" title="springboot加入websocket"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-30</div><div class="info-item-2">springboot加入websocket</div></div><div class="info-2"><div class="info-item-1">一、引入spring-websocket依赖1234&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt;&lt;/dependency&gt;  二、开启websocket支持1234567891011/** * 开启websocket的支持 */@Configurationpublic class WebsocketConfig &#123;    @Bean    public ServerEndpointExporter serverEndpointExporter() &#123;        return new ServerEndpointExporter();    &#125;&#125;  三、websocket工具类12345678910111213141516171819202122232425262728293031323334/** *...</div></div></div></a><a class="pagination-related" href="/spring-springboot%E5%9B%BD%E9%99%85%E5%8C%96%E9%85%8D%E7%BD%AE/" title="springboot国际化配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-03</div><div class="info-item-2">springboot国际化配置</div></div><div class="info-2"><div class="info-item-1"> TODO：暂时留个坑，待整理好思路再写  </div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://s2.loli.net/2024/01/23/uiAYVvz6TSpaqPB.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">张晓风</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">75</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zhangyuliang1994"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BC%95%E5%85%A5spring-boot-starter-data-ldap%E4%BE%9D%E8%B5%96"><span class="toc-number">1.</span> <span class="toc-text">一、引入spring-boot-starter-data-ldap依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">二、配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%AF%B9%E8%B1%A1%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">三、创建用户对象类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-number">4.</span> <span class="toc-text">四、用户登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 示例代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 完整代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E7%A6%81%E7%94%A8"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 判断用户是否禁用</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E7%9E%8E%E6%8A%98%E8%85%BE-%E5%8D%95%E7%BA%BF%E5%A4%8D%E7%94%A8-%E5%AE%B6%E9%87%8C%E5%AE%BD%E5%B8%A6/" title="单线复用--家里宽带">单线复用--家里宽带</a><time datetime="2025-03-01T21:05:21.000Z" title="发表于 2025-03-01 21:05:21">2025-03-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E8%BD%AF%E8%80%83-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-B%E7%AB%99%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" title="计算机网络 - B站学习计划">计算机网络 - B站学习计划</a><time datetime="2025-02-12T20:35:38.000Z" title="发表于 2025-02-12 20:35:38">2025-02-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E7%9E%8E%E6%8A%98%E8%85%BE-%E5%85%89%E7%8C%AB%E8%B7%AF%E7%94%B1%E6%94%B9%E6%A1%A5%E6%8E%A5%EF%BC%8C%E5%90%8C%E6%97%B6%E6%94%AF%E6%8C%81IPTV/" title="光猫路由改桥接，同时支持IPTV">光猫路由改桥接，同时支持IPTV</a><time datetime="2025-01-14T21:48:21.000Z" title="发表于 2025-01-14 21:48:21">2025-01-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3-Centrifugo%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="Centrifugo安装与使用">Centrifugo安装与使用</a><time datetime="2025-01-09T18:32:32.000Z" title="发表于 2025-01-09 18:32:32">2025-01-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3-%E5%9F%BA%E4%BA%8EPrometheus%E7%9A%84API%E6%9F%A5%E8%AF%A2Linux%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87/" title="基于Prometheus的API查询Linux系统指标">基于Prometheus的API查询Linux系统指标</a><time datetime="2025-01-06T18:52:00.000Z" title="发表于 2025-01-06 18:52:00">2025-01-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By 张晓风</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.3</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">苏ICP备2023046043号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.3.3"></script><script src="/js/main.js?v=5.3.3"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.xiaofeng.show',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.xiaofeng.show',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.41/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>