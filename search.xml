<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>websocket 自动断开报错, java.io.EOFException 解决办法</title>
      <link href="/2024/02/23/websocket%E8%BF%9E%E6%8E%A5%E9%94%99%E8%AF%AF-java-io-EOFException-null/"/>
      <url>/2024/02/23/websocket%E8%BF%9E%E6%8E%A5%E9%94%99%E8%AF%AF-java-io-EOFException-null/</url>
      
        <content type="html"><![CDATA[<h3 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h3><p>websocket 服务使用 Nginx 反向代理后，发现会自动断开，查看日志如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2024-02-22 18:51:05:964 1901020240223104709130 [ERROR] websocket连接错误,</span><br><span class="line">java.io.EOFException: null</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.fillReadBuffer(NioEndpoint.java:1339)</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.read(NioEndpoint.java:1226)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFrameServer.onDataAvailable(WsFrameServer.java:75)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFrameServer.doOnDataAvailable(WsFrameServer.java:183)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFrameServer.notifyDataAvailable(WsFrameServer.java:162)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.upgradeDispatch(WsHttpUpgradeHandler.java:157)</span><br><span class="line">        at org.apache.coyote.http11.upgrade.UpgradeProcessorInternal.dispatch(UpgradeProcessorInternal.java:60)</span><br><span class="line">        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:59)</span><br><span class="line">        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:890)</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1743)</span><br><span class="line">        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">        at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)</span><br><span class="line">        at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">        at java.base/java.lang.Thread.run(Thread.java:842)</span><br></pre></td></tr></table></figure><h3 id="二、原因"><a href="#二、原因" class="headerlink" title="二、原因"></a>二、原因</h3><p>使用了 Nginx 反向代理后，超过60秒没有数据传输的连接会自动断开。</p><h3 id="三、解决方法"><a href="#三、解决方法" class="headerlink" title="三、解决方法"></a>三、解决方法</h3><h4 id="1-修改-nginx-配置"><a href="#1-修改-nginx-配置" class="headerlink" title="1. 修改 nginx 配置"></a>1. 修改 nginx 配置</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_read_timeout 3600;</span><br></pre></td></tr></table></figure><p>将超时时间改长一点</p><h3 id="2-前端或者后端加个定时任务发个心跳包就好了，例如："><a href="#2-前端或者后端加个定时任务发个心跳包就好了，例如：" class="headerlink" title="2. 前端或者后端加个定时任务发个心跳包就好了，例如："></a>2. 前端或者后端加个定时任务发个心跳包就好了，例如：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定时任务，由于使用nginx反向代理，60秒无数据传输会断开</span></span><br><span class="line">timer=<span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (websocket.<span class="property">readyState</span> == <span class="number">1</span>) &#123;</span><br><span class="line">websocket.<span class="title function_">send</span>(<span class="string">&quot;心跳包检测&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//IM连接已断开</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;, <span class="number">50</span> * <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> websocket </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BigDecimal比较大小</title>
      <link href="/2024/02/22/BigDecimal%E6%AF%94%E8%BE%83%E5%A4%A7%E5%B0%8F/"/>
      <url>/2024/02/22/BigDecimal%E6%AF%94%E8%BE%83%E5%A4%A7%E5%B0%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这个类是Java里精确计算的类，下面说一下BidDecimal大小、相等的判断</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">1.0</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> BigDecimal.valueOf(<span class="number">1.000</span>);</span><br></pre></td></tr></table></figure><h3 id="一、比较方法"><a href="#一、比较方法" class="headerlink" title="一、比较方法"></a>一、比较方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a.compareTo(b);</span><br></pre></td></tr></table></figure><h3 id="二、比较结果"><a href="#二、比较结果" class="headerlink" title="二、比较结果"></a>二、比较结果</h3><ul><li>-1 小于</li><li>0  等于</li><li>1  大于</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java通过SSH连接路由器，输入命令并读取响应</title>
      <link href="/2024/02/20/Java%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%B9%B6%E8%AF%BB%E5%8F%96%E5%93%8D%E5%BA%94/"/>
      <url>/2024/02/20/Java%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%B9%B6%E8%AF%BB%E5%8F%96%E5%93%8D%E5%BA%94/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近需要读取和修改华为路由器的配置，使用Java语言开发，通过SSH连接，输入命令并读取响应。</p></blockquote><h3 id="1-添加mwiede-jsch依赖"><a href="#1-添加mwiede-jsch依赖" class="headerlink" title="1.添加mwiede/jsch依赖"></a>1.添加<code>mwiede/jsch</code>依赖</h3><ul><li>如果使用Maven，可以在pom.xml文件中添加以下依赖:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.mwiede<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>如果使用Gradle，则添加到build.gradle文件:<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">&#x27;com.github.mwiede:jsch:0.2.15&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-使用Jsch创建SSH连接，输入命令并返回响应"><a href="#2-使用Jsch创建SSH连接，输入命令并返回响应" class="headerlink" title="2.使用Jsch创建SSH连接，输入命令并返回响应"></a>2.使用<code>Jsch</code>创建SSH连接，输入命令并返回响应</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">*  获取SSH命令响应</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> userName        用户名</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> password        密码</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> host              ip地址</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> port              端口</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> commandList  命令列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getShellCmdRes</span><span class="params">(String userName, String password, String host, Integer port, List&lt;String&gt; commandList)</span> <span class="keyword">throws</span> JSchException, IOException &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">JSch</span> <span class="variable">jsch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSch</span>();</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> jsch.getSession(userName, host, port());</span><br><span class="line">        session.setPassword(password);</span><br><span class="line">        session.setConfig(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">        session.connect();</span><br><span class="line"></span><br><span class="line">        <span class="type">ChannelShell</span> <span class="variable">channel</span> <span class="operator">=</span> (ChannelShell) session.openChannel(<span class="string">&quot;shell&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取输入输出流</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">inputStreamForTheChannel</span> <span class="operator">=</span> channel.getOutputStream();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">outputStreamForTheChannel</span> <span class="operator">=</span> channel.getInputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 连接通道</span></span><br><span class="line">        channel.connect();</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintStream</span> <span class="variable">commander</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(inputStreamForTheChannel, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] tmp = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (outputStreamForTheChannel.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> outputStreamForTheChannel.read(tmp, <span class="number">0</span>, <span class="number">1024</span>);</span><br><span class="line">                <span class="keyword">if</span> (i &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(tmp, <span class="number">0</span>, i);</span><br><span class="line">                <span class="comment">// 读取响应</span></span><br><span class="line">                stringBuilder.append(output);</span><br><span class="line">                stringBuilder.append(System.lineSeparator());</span><br><span class="line">                <span class="comment">// 发送命令</span></span><br><span class="line">                commandList.forEach(command -&gt; &#123;</span><br><span class="line">                    commander.println(command);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (channel.isClosed()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (outputStreamForTheChannel.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ee) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭通道和会话</span></span><br><span class="line">        channel.disconnect();</span><br><span class="line">        session.disconnect();</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="3-调用上文方法"><a href="#3-调用上文方法" class="headerlink" title="3.调用上文方法"></a>3.调用上文方法</h3><h4 id="3-1-单条命令"><a href="#3-1-单条命令" class="headerlink" title="3.1 单条命令"></a>3.1 单条命令</h4><p>记得结束时加入退出语句，这里以路由器为例，用quit退出</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; commandList = <span class="keyword">new</span>  <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 查看</span></span><br><span class="line">commandList.add(<span class="string">&quot;display bfd session all&quot;</span>);</span><br><span class="line"><span class="comment">// 退出会话</span></span><br><span class="line">commandList.add(<span class="string">&quot;quit&quot;</span>);</span><br><span class="line"><span class="comment">// 获取响应</span></span><br><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> getShellCmdRes(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;1.1.1.1&quot;</span>, <span class="number">22</span>, List&lt;String&gt; commandList)</span><br></pre></td></tr></table></figure><p><img src="/2024/02/20/Java%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%B9%B6%E8%AF%BB%E5%8F%96%E5%93%8D%E5%BA%94/single.jpg" alt="本地图片"></p><h4 id="3-2-多条命令"><a href="#3-2-多条命令" class="headerlink" title="3.2 多条命令"></a>3.2 多条命令</h4><p>如果是多条命令，每进入一个会话，就多一个退出语句</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; commandList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 进入system-view</span></span><br><span class="line">commandList.add(<span class="string">&quot;system-view&quot;</span>);</span><br><span class="line"><span class="comment">// 进入Tunnel 0/0/5</span></span><br><span class="line">commandList.add(<span class="string">&quot;interface Tunnel 0/0/5&quot;</span>);</span><br><span class="line"><span class="comment">// 查看信息</span></span><br><span class="line">commandList.add(<span class="string">&quot;display this&quot;</span>);</span><br><span class="line"><span class="comment">// 退出Tunnel 0/0/5</span></span><br><span class="line">commandList.add(<span class="string">&quot;quit&quot;</span>);</span><br><span class="line"><span class="comment">// 退出system-view</span></span><br><span class="line">commandList.add(<span class="string">&quot;quit&quot;</span>);</span><br><span class="line"><span class="comment">// 退出会话</span></span><br><span class="line">commandList.add(<span class="string">&quot;quit&quot;</span>);</span><br><span class="line"><span class="comment">// 获取响应</span></span><br><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> getShellCmdRes(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;1.1.1.1&quot;</span>, <span class="number">22</span>, List&lt;String&gt; commandList)</span><br></pre></td></tr></table></figure><p><img src="/2024/02/20/Java%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%B9%B6%E8%AF%BB%E5%8F%96%E5%93%8D%E5%BA%94/mutile.jpg" alt="本地图片"></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将nginx设置为开机自启动的配置</title>
      <link href="/2024/02/20/%E5%B0%86nginx%E8%AE%BE%E7%BD%AE%E4%B8%BA%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/02/20/%E5%B0%86nginx%E8%AE%BE%E7%BD%AE%E4%B8%BA%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E7%9A%84%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="一、背景描述"><a href="#一、背景描述" class="headerlink" title="一、背景描述"></a>一、背景描述</h3><p>虚拟机上安装了nginx，希望能够开机自启动。</p><h3 id="二、操作步骤"><a href="#二、操作步骤" class="headerlink" title="二、操作步骤"></a>二、操作步骤</h3><h4 id="1-进入-lib-systemd-system-目录下"><a href="#1-进入-lib-systemd-system-目录下" class="headerlink" title="1.进入 &#x2F;lib&#x2F;systemd&#x2F;system&#x2F; 目录下"></a>1.进入 &#x2F;lib&#x2F;systemd&#x2F;system&#x2F; 目录下</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /lib/systemd/system/</span><br></pre></td></tr></table></figure><h4 id="2-创建文件：nginx-service"><a href="#2-创建文件：nginx-service" class="headerlink" title="2.创建文件：nginx.service"></a>2.创建文件：nginx.service</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch nginx.service</span><br><span class="line">vim nginx.service</span><br></pre></td></tr></table></figure><h4 id="3-编辑文件内容"><a href="#3-编辑文件内容" class="headerlink" title="3.编辑文件内容"></a>3.编辑文件内容</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx service</span><br><span class="line">After=network.target </span><br><span class="line">   </span><br><span class="line">[Service] </span><br><span class="line">Type=forking </span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true </span><br><span class="line">   </span><br><span class="line">[Install] </span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h4 id="4-开机自启动"><a href="#4-开机自启动" class="headerlink" title="4.开机自启动"></a>4.开机自启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决Nginx的failed 13 Permission denied while connecting to upstream</title>
      <link href="/2024/02/20/%E8%A7%A3%E5%86%B3Nginx%E7%9A%8413-Permission-denied%E9%97%AE%E9%A2%98/"/>
      <url>/2024/02/20/%E8%A7%A3%E5%86%B3Nginx%E7%9A%8413-Permission-denied%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h3 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h3><p>最近在用nginx做反向代理的时候遇到这样一个问题：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2024/02/19 17:15:32 [crit] 3025#3025: *2 connect() to 127.0.0.1:19010 failed (13: Permission denied) while connecting to upstream, client: 10.64.68.30, server: , request: &quot;POST /opticTransceiver/addDeviceList HTTP/1.1&quot;, upstream: &quot;http://127.0.0.1:19010/opticTransceiver/addDeviceList&quot;, host: &quot;localhost:8080&quot;, referrer: &quot;http://localhost:8080/device-connect&quot;</span><br></pre></td></tr></table></figure><h3 id="二、原因"><a href="#二、原因" class="headerlink" title="二、原因"></a>二、原因</h3><p>是因为SeLinux的限制。</p><h3 id="三、解决"><a href="#三、解决" class="headerlink" title="三、解决"></a>三、解决</h3><h4 id="1-关闭SeLinux的限制"><a href="#1-关闭SeLinux的限制" class="headerlink" title="1.关闭SeLinux的限制"></a>1.关闭SeLinux的限制</h4><h5 id="1-临时关闭-不用重启机器"><a href="#1-临时关闭-不用重启机器" class="headerlink" title="1) 临时关闭(不用重启机器)"></a>1) 临时关闭(不用重启机器)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 ##设置SELinux 成为permissive模式</span><br></pre></td></tr></table></figure><h5 id="2-修改配置文件-需要重启机器"><a href="#2-修改配置文件-需要重启机器" class="headerlink" title="2) 修改配置文件(需要重启机器)"></a>2) 修改配置文件(需要重启机器)</h5><p>修改&#x2F;etc&#x2F;selinux&#x2F;config 文件<br>将SELINUX&#x3D;enforcing改为SELINUX&#x3D;disabled<br>重启机器即可</p><h4 id="2-执行下面的命令"><a href="#2-执行下面的命令" class="headerlink" title="2.执行下面的命令"></a>2.执行下面的命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsebool -P httpd_can_network_connect 1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot加入websocket</title>
      <link href="/2024/01/30/springboot%E5%8A%A0%E5%85%A5websocket/"/>
      <url>/2024/01/30/springboot%E5%8A%A0%E5%85%A5websocket/</url>
      
        <content type="html"><![CDATA[<h3 id="一、引入spring-websocket依赖"><a href="#一、引入spring-websocket依赖" class="headerlink" title="一、引入spring-websocket依赖"></a>一、引入<code>spring-websocket</code>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="二、开启websocket支持"><a href="#二、开启websocket支持" class="headerlink" title="二、开启websocket支持"></a>二、开启websocket支持</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开启websocket的支持</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebsocketConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、websocket工具类"><a href="#三、websocket工具类" class="headerlink" title="三、websocket工具类"></a>三、websocket工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * websocket工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebsocketUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">WebsocketUtil</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务端存放客户端对应的session对象</span></span><br><span class="line"><span class="comment">     * key:clientId value:session</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Session&gt; WEBSOCKET_CLIENT_SESSION_MAP = Maps.newConcurrentMap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务端发送消息给所有客户端</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessageToAllClient</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (WEBSOCKET_CLIENT_SESSION_MAP.isEmpty()) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;当前无连接的客户端, 消息忽略推送.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        WEBSOCKET_CLIENT_SESSION_MAP.forEach((sessionId, session) -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                session.getBasicRemote().sendText(message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;服务端向客户端[&#123;&#125;]发送消息异常.&quot;</span>, sessionId, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="四、websocket服务端"><a href="#四、websocket服务端" class="headerlink" title="四、websocket服务端"></a>四、websocket服务端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * websocket服务端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebsocketServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sessionId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * websocket建立连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.sessionId = session.getId();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (WebsocketUtil.WEBSOCKET_CLIENT_SESSION_MAP.containsKey(<span class="built_in">this</span>.sessionId)) &#123;</span><br><span class="line">            WebsocketUtil.WEBSOCKET_CLIENT_SESSION_MAP.remove(<span class="built_in">this</span>.sessionId).close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        WebsocketUtil.WEBSOCKET_CLIENT_SESSION_MAP.put(<span class="built_in">this</span>.sessionId, session);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;客户端[&#123;&#125;]建立websocket连接.&quot;</span>, <span class="built_in">this</span>.sessionId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭socket连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Session session)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (WebsocketUtil.WEBSOCKET_CLIENT_SESSION_MAP.containsKey(session.getId())) &#123;</span><br><span class="line">            WebsocketUtil.WEBSOCKET_CLIENT_SESSION_MAP.remove(session.getId());</span><br><span class="line">            log.info(<span class="string">&quot;客户端[&#123;&#125;]断开websocket连接.&quot;</span>, session.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收到消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;接收到客户端&#123;&#125;发送的消息:[&#123;&#125;].&quot;</span>, <span class="built_in">this</span>.sessionId, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接错误</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> error</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnError</span><span class="params">(Session session, Throwable error)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;websocket连接错误,&quot;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="五、测试"><a href="#五、测试" class="headerlink" title="五、测试"></a>五、测试</h3><blockquote><p>推荐使用Chrome插件–Simple Web Socket Client</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git常用命令</title>
      <link href="/2024/01/25/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2024/01/25/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="代理相关"><a href="#代理相关" class="headerlink" title="代理相关"></a>代理相关</h2><h3 id="设置http代理"><a href="#设置http代理" class="headerlink" title="设置http代理"></a>设置http代理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy 127.0.0.1:7890</span><br><span class="line">git config --global https.proxy 127.0.0.1:7890</span><br></pre></td></tr></table></figure><h3 id="查看http代理"><a href="#查看http代理" class="headerlink" title="查看http代理"></a>查看http代理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --get http.proxy</span><br><span class="line">git config --global --get https.proxy</span><br></pre></td></tr></table></figure><h3 id="取消设置http代理"><a href="#取消设置http代理" class="headerlink" title="取消设置http代理"></a>取消设置http代理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 开发相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
